/*! Mosaico Cropper - v0.9.0 - 2019-03-11
* Copyright (c) 2019 ; MIT license */

!function(_){_.widget("mosaico.mosaicoCropper",{options:{autoClose:!0,shiftWheel:!1},_init:function(){void 0!==this.options.instance&&this.options.instance.dispose(!0),this.options.instance=function(r,s,n){function d(i){return{width:Math.round(W.width*(i||A.scale)),height:Math.round(W.height*(i||A.scale))}}function a(){return A.scale}function l(){return void 0!==s.maxScale?s.maxScale:2}var t,c=!1,h=!1;function p(i){c&&clearTimeout(c),h||(b.addClass("cropper-moving"),b.addClass("cropper-moving-"+i),h=i)}function u(){c&&clearTimeout(c),h&&(b.removeClass("cropper-moving"),b.removeClass("cropper-moving-"+h),h=!1)}function g(i,t,e){return i<t?t:e<i?e:i}function f(i,t){A.crop.height=parseInt(i),void 0!==t&&(A.crop.width=parseInt(t),b.css({width:A.crop.width+"px"})),P.css({height:A.crop.height+"px",width:A.crop.width+"px"});var e=s.width/W.width,o=A.crop.height/W.height,r=Math.max(e,o);r!==A.minScale&&(A.minScale=r,T.slider({min:x(r)}))}function v(i,t,e,o){var r=!1;void 0!==e&&(r=function(i){{if(A.scale===i)return!1;A.scale=i;var t=d(),e={width:t.width+"px",height:t.height+"px"};return O.css(e),k.css(e),!0}}(e));var n=d();if(void 0!==i&&(i=g(i,A.crop.width-n.width,0),A.container.left!==i&&(A.container.left=i,r=!0)),void 0!==t&&(t=g(t,A.crop.height-n.height,0),A.container.top!==t&&(A.container.top=t,r=!0)),r){var a={left:A.container.left+"px",top:A.container.top+"px"};(void 0===o||o)&&k.css(a),O.css(a)}return r}function m(i,t,e,o){var r=d();if(null==t&&(t=(A.crop.width/2-A.container.left)/r.width),null==e&&(e=(A.crop.height/2-A.container.top)/r.height),(i=g(i,A.minScale,l()))!==A.scale){var n=d(i),a=Math.round((n.width-r.width)*t),c=Math.round((n.height-r.height)*e),s=A.container.left-a,h=A.container.top-c;v(s,h,i),!1!==o&&T.slider("value",x(i))}}function w(i,t,e,o){!s.autoZoom&&o<i&&(i=o),i=Math.round(i);var r=Math.round((i-t)/2)+e;0<r&&(r=0),f(i);a();o<i?m(i/W.height):v(void 0,r)}function C(i){var t=A.crop.height;w(i,t,A.container.top,d().height)}function M(){var i,t,e,o,r,n=(o=d(i=A.minScale),t=Math.round((A.crop.width-o.width)/2),e=Math.round((A.crop.height-o.height)/2),v(t,e,i));n||(r=s.width/W.width,C(Math.round(W.height*r)),m(r)),z()}function x(i){return Math.log(100*i)/Math.log(1.03)}function z(){var i=e();t!==i.method&&(b.removeClass("cropper-method-"+t),t=i.method,b.addClass("cropper-method-"+t)),b.addClass("cropper-has-changes")}function e(){var i=d(),t=-A.container.left,e=i.width-A.crop.width+A.container.left,o=-A.container.top,r=i.height-A.crop.height+A.container.top,n={resizeWidth:i.width,resizeHeight:i.height,offsetX:Math.max(0,-A.container.left),offsetY:Math.max(0,-A.container.top),cropX:Math.max(0,Math.round(t/A.scale)),cropY:Math.max(0,Math.round(o/A.scale)),cropWidth:Math.round(A.crop.width/A.scale),cropHeight:Math.round(A.crop.height/A.scale),width:A.crop.width,height:A.crop.height};n.cropX2=n.cropX+n.cropWidth,n.cropY2=n.cropY+n.cropHeight;var a=Math.abs(t-e),c=Math.abs(o-r);return n.method=void 0!==s.cropX?"cropresize":"resizecrop",a<=1&&c<=1&&(0===t||0===o)&&(n.method=0===t&&0===o?1!==A.scale?"resize":"original":"cover"),n}function o(){var i=e();i.urlPrefix=s.urlPrefix,i.urlPostfix=s.urlPostfix,i.urlOriginal=s.urlOriginal,i.cropThenResize=void 0!==s.cropX,i.encodedUrlOriginal=encodeURIComponent(s.urlOriginal);var t=s.urlAdapter.toSrc;return"object"==typeof t&&(t=!i.cropThenResize&&t.resizeThenCrop?t.resizeThenCrop:t.default),"string"==typeof t&&(t=function(i,r){return i.replace(/\{([^[\}]+)\}/g,function(i,t,e,o){return r.hasOwnProperty(t)?void 0!==r[t]?r[t]:"":i})}.bind(void 0,t)),t(i)}function S(){var e,i;L||(L=!0,e=X,i=o(),b.addClass("cropper-loading"),y(i,function(i,t){_(r).attr("src",t),b.removeClass("cropper-loading"),e()}),b.removeClass("cropper-has-changes"),s.imgLoadingClass&&_(r).removeClass(s.imgLoadingClass))}function X(i){I||(I=!0,U&&U.removeClass("cropper-cropping"),P.resizable("destroy"),k.draggable("destroy"),T.slider("destroy"),b.remove(),s.imgLoadingClass&&_(r).removeClass(s.imgLoadingClass),_(r).css("display",R),i||void 0===n||n.destroy())}function y(i,t){var e=new Image;e.onload=function(){t(e,i)},e.src=i}var H={encodedUrlOriginal:"[^ &\\?]+",width:"[0-9]+",height:"[0-9]+",resizeWidth:"[0-9]+",resizeHeight:"[0-9]+",offsetX:"[0-9]+",offsetY:"[0-9]+",cropWidth:"[0-9]+",cropHeight:"[0-9]+",cropX:"[0-9]+",cropY:"[0-9]+",cropX2:"[0-9]+",cropY2:"[0-9]+"};var b=_('<div class="mo-cropper cropper-hidden" tabindex="-1"><div class="cropper-frame"><div class="clipping-container"><div class="toolbar"><div class="tool tool-zoom"><i class="fa fa-compress" aria-hidden="true"></i></div><div class="copper-zoom-slider"></div><div class="tool tool-crop"><i class="fa fa-check" aria-hidden="true"></i></div></div><img draggable="false" class="clipped clipped-image original-src"></div><div class="clip-handle ui-resizable-s"></div></div><div class="outer-image-container"><img class="outer-image original-src"></div></div>');_(r).after(b),s.imgLoadingClass&&_(r).addClass(s.imgLoadingClass);var i=s.urlAdapter.fromSrc;"string"==typeof i&&(i=function(i,t){var a=[],e=new RegExp("^"+i.replace(/\\.|(\((?!\?[!:=]))|\{([^:\}]+)(?::([^\}]+))?\}/g,function(e,i,t,o,r,n){if(i)return a.push(""),e;if(t){if(a.push(t),o)return o.replace(/\\.|(\((?!\?[!:=]))/g,function(i,t){return t&&a.push(""),e}),"("+o+")";if(H[t])return"("+H[t]+")";throw"Uknown token "+t+", please use {"+t+":regex} or use a known pattern"}return e})+"$"),o=t.match(e),r=null;if(null!==o){o.length!==a.length+1&&console.log("ERROR parsing pattern!",i,a,o),r={};for(var n=0;n<a.length;n++)""!==a[n]&&void 0!==o[n+1]&&(r[a[n]]=o[n+1])}return r}.bind(void 0,i));var Y=i(r.src);Y?Y.encodedUrlOriginal&&(Y.urlOriginal=decodeURIComponent(Y.encodedUrlOriginal)):void 0!==s.urlAdapter.defaultPrefix?(s.urlOriginal=r.src,s.urlPrefix=s.urlAdapter.defaultPrefix,s.urlPostfix=r.src):console.error("FAILED PARSING",r.src);_.extend(s,Y),s.width||(s.width=r.width,s.height=r.height);var W,O=b.find(".clipped"),P=b.find(".cropper-frame"),k=b.find(".outer-image-container"),T=b.find(".copper-zoom-slider"),R=_(r).css("display"),I=!1,L=!1,U=!1;void 0!==s.containerSelector&&(U=_(s.containerSelector));var A={container:{},crop:{}},E=s.urlOriginal||(s.urlPrefix||"")+(s.urlPostfix||"");E.match(/[a-z]+:/)||(E="http://"+E);return y(E,function(i,t){var e,o;b.find(".original-src").attr("src",t),W={width:i.naturalWidth,height:i.naturalHeight},U&&U.addClass("cropper-cropping"),!1!==s.autoClose&&b.focusout(function(i){null!=i.relatedTarget&&b.get(0).contains(i.relatedTarget)||void 0!==i.delegatedTarget||I||S()}),b.find(".tool-crop").on("click",function(){S()}),b.find(".tool-zoom").on("click",function(){M()}),b.focus(),function(){var i,t,e,o,r;if(void 0!==s.resizeWidth)o=s.resizeWidth/W.width,i=s.height,r=s.width,t=-s.offsetX,e=-s.offsetY;else if(void 0!==s.cropX2||void 0!==s.cropWidth)null==s.cropWidth&&(s.cropWidth=s.cropX2-s.cropX),null==s.cropHeight&&(s.cropHeight=s.cropY2-s.cropY),null==s.cropX&&(s.cropX=0),null==s.cropY&&(s.cropY=0),o=s.width/s.cropWidth,i=s.height||s.cropHeight*o,r=s.width,t=Math.round(-s.cropX*o),e=Math.round(-s.cropY*o);else{o=s.width/W.width,i=s.height||Math.round(W.height*o),r=s.width;var n=d(o);t=Math.round((r-n.width)/2),e=Math.round((i-n.height)/2)}f(i,r),v(t,e,o)}(),P.resizable({minHeight:40,handles:{s:".clip-handle"},start:function(i,t){b.focus(),p("handle"),e=A.container.top,o=d().height},stop:function(i,t){u(),z()},resize:function(i,t){w(t.size.height,t.originalSize.height,e,o),z(),t.size.height=A.crop.height,void 0!==n&&n._trigger("cropheight",null,{value:A.crop.height})}}),k.draggable({scroll:!1,start:function(i,t){b.focus(),p("drag")},stop:function(i,t){z(),u()},drag:function(i,t){v(Math.round(t.position.left),Math.round(t.position.top),void 0,!1),t.position.left=A.container.left,t.position.top=A.container.top,z()}}).on("wheel",function(i){if(s.shiftWheel&&!i.shiftKey)return!0;var t=-i.originalEvent.deltaY;if(b.focus(),0!==t){p("wheel"),c=setTimeout(u,500);var e=d(),o=i.originalEvent.offsetX/e.width,r=i.originalEvent.offsetY/e.height,n=0<t?1.1*A.scale:A.scale/1.1;m(n,o,r),z()}return!1}).on("dblclick",function(i){M()}).on("click",function(i){var t;b.focus(),t="click",h?u():p(t)}),T.slider({min:Math.floor(x(A.minScale)),step:1,value:Math.round(x(A.scale)),max:Math.ceil(x(l())),slide:function(i,t){var e,o=(e=t.value,Math.pow(1.03,e)/100);m(o,void 0,void 0,!1),z(),t.value=x(A.scale)},start:function(){p("slide")},stop:function(){u()}}),_(r).css("display","none"),b.css("display","inline"==R?"inline-block":R),b.removeClass("cropper-hidden"),b.focus(),void 0!==n&&n._trigger("copperready")}),{getScale:a,updateScale:m,getCropHeight:function(){return A.crop.Height},updateCropHeight:C,dispose:X}}(this.element.get(0),this.options,this)},scale:function(i){if(void 0===i)return this.options.instance.getScale();this.options.instance.updateScale(i)},cropHeight:function(i){if(void 0===i)return this.options.instance.getCropHeight();this.options.instance.updateCropHeight(i)},_destroy:function(){this.options.instance.dispose(!0)}})}(jQuery);
//# sourceMappingURL=jqueryui-mosaico-cropper.min.js.map