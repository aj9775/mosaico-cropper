/*! Mosaico Cropper - v0.9.0 - 2019-03-11
* Copyright (c) 2019 ; MIT license */

!function(U){U.widget("mosaico.mosaicoCropper",{options:{autoClose:!0,shiftWheel:!1},_init:function(){void 0!==this.options.instance&&this.options.instance.dispose(!0),this.options.instance=function(r,a,n){function l(i){return{width:Math.round(S.width*(i||k.scale)),height:Math.round(S.height*(i||k.scale))}}function c(){return k.scale}function d(){return void 0!==a.maxScale?a.maxScale:2}var s=!1,h=!1;function p(i){s&&clearTimeout(s),h||(H.addClass("cropper-moving"),H.addClass("cropper-moving-"+i),h=i)}function u(){s&&clearTimeout(s),h&&(H.removeClass("cropper-moving"),H.removeClass("cropper-moving-"+h),h=!1)}function g(i,e,t){return i<e?e:t<i?t:i}function f(i,e){k.crop.height=i,void 0!==e&&(k.crop.width=e,H.css({width:k.crop.width+"px"})),Y.css({height:k.crop.height+"px",width:k.crop.width+"px"});var t=a.width/S.width,o=k.crop.height/S.height,r=Math.max(t,o);r!==k.minScale&&(k.minScale=r,b.slider({min:C(r)}))}function v(i,e,t,o){var r=!1;void 0!==t&&(r=function(i){{if(k.scale===i)return!1;k.scale=i;var e=l(),t={width:e.width+"px",height:e.height+"px"};return X.css(t),W.css(t),!0}}(t));var n=l();if(void 0!==i&&(i=g(i,k.crop.width-n.width,0),k.container.left!==i&&(k.container.left=i,r=!0)),void 0!==e&&(e=g(e,k.crop.height-n.height,0),k.container.top!==e&&(k.container.top=e,r=!0)),r){var a={left:k.container.left+"px",top:k.container.top+"px"};(void 0===o||o)&&W.css(a),X.css(a)}return r}function m(i,e,t,o){var r=l();if(null==e&&(e=(k.crop.width/2-k.container.left)/r.width),null==t&&(t=(k.crop.height/2-k.container.top)/r.height),(i=g(i,k.minScale,d()))!==k.scale){var n=l(i),a=Math.round((n.width-r.width)*e),c=Math.round((n.height-r.height)*t),s=k.container.left-a,h=k.container.top-c;v(s,h,i),!1!==o&&b.slider("value",C(i))}}function w(i,e,t,o){!a.autoZoom&&o<i&&(i=o),i=Math.round(i);var r=Math.round((i-e)/2)+t;0<r&&(r=0),f(i);c();o<i?m(i/S.height):v(void 0,r)}function C(i){return Math.log(100*i)/Math.log(1.03)}function x(){H.addClass("cropper-has-changes")}function e(){var i=l(),e={resizeWidth:i.width,resizeHeight:i.height,offsetX:Math.max(-k.container.left),offsetY:Math.max(-k.container.top),cropX:Math.max(0,Math.round(-k.container.left/k.scale)),cropY:Math.max(0,Math.round(-k.container.top/k.scale)),cropWidth:Math.round(k.crop.width/k.scale),cropHeight:Math.round(k.crop.height/k.scale),width:k.crop.width,height:k.crop.height,urlPrefix:a.urlPrefix,urlPostfix:a.urlPostfix,urlOriginal:a.urlOriginal,encodedUrlOriginal:encodeURIComponent(a.urlOriginal),cropThenResize:void 0!==a.cropX};e.cropX2=e.cropX+e.cropWidth,e.cropY2=e.cropY+e.cropHeight;var t=a.urlAdapter.toSrc;return"object"==typeof t&&(t=!e.cropThenResize&&t.resizeThenCrop?t.resizeThenCrop:t.default),"string"==typeof t&&(t=function(i,r){return i.replace(/\{([^[\}]+)\}/g,function(i,e,t,o){return r.hasOwnProperty(e)?void 0!==r[e]?r[e]:"":i})}.bind(void 0,t)),t(e)}function M(){var t,i;T||(T=!0,t=o,i=e(),H.addClass("cropper-loading"),z(i,function(i,e){U(r).attr("src",e),H.removeClass("cropper-loading"),t()}),H.removeClass("cropper-has-changes"),a.imgLoadingClass&&U(r).removeClass(a.imgLoadingClass))}function o(i){P||(P=!0,R&&R.removeClass("cropper-cropping"),Y.resizable("destroy"),W.draggable("destroy"),b.slider("destroy"),H.remove(),a.imgLoadingClass&&U(r).removeClass(a.imgLoadingClass),U(r).css("display",O),i||void 0===n||n.destroy())}function z(i,e){var t=new Image;t.onload=function(){e(t,i)},t.src=i}var y={encodedUrlOriginal:"[^ &\\?]+",width:"[0-9]+",height:"[0-9]+",resizeWidth:"[0-9]+",resizeHeight:"[0-9]+",offsetX:"[0-9]+",offsetY:"[0-9]+",cropWidth:"[0-9]+",cropHeight:"[0-9]+",cropX:"[0-9]+",cropY:"[0-9]+",cropX2:"[0-9]+",cropY2:"[0-9]+"};var H=U('<div class="mo-cropper cropper-hidden" tabindex="-1"><div class="cropper-frame"><div class="clipping-container"><div class="toolbar"><div class="copper-zoom-slider"></div><div class="tool-crop"><i class="fa fa-check" aria-hidden="true"></i></div></div><img draggable="false" class="clipped clipped-image original-src"></div><div class="clip-handle ui-resizable-s"></div></div><div class="outer-image-container"><img class="outer-image original-src"></div></div>');U(r).after(H),a.imgLoadingClass&&U(r).addClass(a.imgLoadingClass);var i=a.urlAdapter.fromSrc;"string"==typeof i&&(i=function(i,e){var a=[],t=new RegExp("^"+i.replace(/\\.|(\((?!\?[!:=]))|\{([^:\}]+)(?::([^\}]+))?\}/g,function(t,i,e,o,r,n){if(i)return a.push(""),t;if(e){if(a.push(e),o)return o.replace(/\\.|(\((?!\?[!:=]))/g,function(i,e){return e&&a.push(""),t}),"("+o+")";if(y[e])return"("+y[e]+")";throw"Uknown token "+e+", please use {"+e+":regex} or use a known pattern"}return t})+"$"),o=e.match(t),r=null;if(null!==o){o.length!==a.length+1&&console.log("ERROR parsing pattern!",i,a,o),r={};for(var n=0;n<a.length;n++)""!==a[n]&&void 0!==o[n+1]&&(r[a[n]]=o[n+1])}return r}.bind(void 0,i));var t=i(r.src);t?t.encodedUrlOriginal&&(t.urlOriginal=decodeURIComponent(t.encodedUrlOriginal)):void 0!==a.urlAdapter.defaultPrefix?(a.urlOriginal=r.src,a.urlPrefix=a.urlAdapter.defaultPrefix,a.urlPostfix=r.src):console.error("FAILED PARSING",r.src);U.extend(a,t),a.width||(a.width=r.width,a.height=r.height);var S,X=H.find(".clipped"),Y=H.find(".cropper-frame"),W=H.find(".outer-image-container"),b=H.find(".copper-zoom-slider"),O=U(r).css("display"),P=!1,T=!1,R=!1;void 0!==a.containerSelector&&(R=U(a.containerSelector));var k={container:{},crop:{}},L=a.urlOriginal||(a.urlPrefix||"")+(a.urlPostfix||"");L.match(/[a-z]+:/)||(L="http://"+L);return z(L,function(i,e){var t,o;H.find(".original-src").attr("src",e),S={width:i.naturalWidth,height:i.naturalHeight},R&&R.addClass("cropper-cropping"),!1!==a.autoClose&&H.focusout(function(i){null!=i.relatedTarget&&H.get(0).contains(i.relatedTarget)||void 0!==i.delegatedTarget||P||M()}),H.find(".tool-crop").on("click",function(){M()}),H.focus(),function(){var i,e,t,o,r;if(void 0!==a.resizeWidth)o=a.resizeWidth/S.width,i=a.height,r=a.width,e=-a.offsetX,t=-a.offsetY;else if(void 0!==a.cropX2||void 0!==a.cropWidth)null==a.cropWidth&&(a.cropWidth=a.cropX2-a.cropX),null==a.cropHeight&&(a.cropHeight=a.cropY2-a.cropY),null==a.cropX&&(a.cropX=0),null==a.cropY&&(a.cropY=0),o=a.width/a.cropWidth,i=a.height||a.cropHeight*o,r=a.width,e=Math.round(-a.cropX*o),t=Math.round(-a.cropY*o);else{o=a.width/S.width,i=a.height||Math.round(S.height*o),r=a.width;var n=l(o);e=Math.round((r-n.width)/2),t=Math.round((i-n.height)/2)}f(i,r),v(e,t,o)}(),Y.resizable({minHeight:40,handles:{s:".clip-handle"},start:function(i,e){H.focus(),p("handle"),t=k.container.top,o=l().height},stop:function(i,e){u(),x()},resize:function(i,e){w(e.size.height,e.originalSize.height,t,o),x(),e.size.height=k.crop.height,void 0!==n&&n._trigger("cropheight",null,{value:k.crop.height})}}),W.draggable({scroll:!1,start:function(i,e){H.focus(),p("drag")},stop:function(i,e){x(),u()},drag:function(i,e){v(Math.round(e.position.left),Math.round(e.position.top),void 0,!1),e.position.left=k.container.left,e.position.top=k.container.top,x()}}).on("wheel",function(i){if(a.shiftWheel&&!i.shiftKey)return!0;var e=-i.originalEvent.deltaY;if(H.focus(),0!==e){p("wheel"),s=setTimeout(u,500);var t=l(),o=i.originalEvent.offsetX/t.width,r=i.originalEvent.offsetY/t.height,n=0<e?1.1*k.scale:k.scale/1.1;m(n,o,r),x()}return!1}).on("click",function(i){var e;H.focus(),e="click",h?u():p(e)}),b.slider({min:Math.floor(C(k.minScale)),step:1,value:Math.round(C(k.scale)),max:Math.ceil(C(d())),slide:function(i,e){var t,o=(t=e.value,Math.pow(1.03,t)/100);m(o,void 0,void 0,!1),x(),e.value=C(k.scale)},start:function(){p("slide")},stop:function(){u()}}),U(r).css("display","none"),H.css("display","inline"==O?"inline-block":O),H.removeClass("cropper-hidden"),H.focus(),void 0!==n&&n._trigger("copperready")}),{getScale:c,updateScale:m,getCropHeight:function(){return k.crop.Height},updateCropHeight:function(i){var e=k.crop.height;w(i,e,k.container.top,l().height)},dispose:o}}(this.element.get(0),this.options,this)},scale:function(i){if(void 0===i)return this.options.instance.getScale();this.options.instance.updateScale(i)},cropHeight:function(i){if(void 0===i)return this.options.instance.getCropHeight();this.options.instance.updateCropHeight(i)},_destroy:function(){this.options.instance.dispose(!0)}})}(jQuery);
//# sourceMappingURL=jqueryui-mosaico-cropper.min.js.map