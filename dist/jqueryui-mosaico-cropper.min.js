/*! Mosaico Cropper - v0.9.0 - 2019-03-01
* Copyright (c) 2019 ; Licensed under the MIT terms */

!function(k){k.widget("mosaico.mosaicoCropper",{options:{autoClose:!0,shiftWheel:!1},_init:function(){void 0!==this.options.instance&&this.options.instance.dispose(!0),this.options.instance=function(r,a,n){function d(i){return{width:Math.round(H.width*(i||T.scale)),height:Math.round(H.height*(i||T.scale))}}function c(){return T.scale}function l(){return void 0!==a.maxScale?a.maxScale:2}var s=!1,h=!1;function p(i){s&&clearTimeout(s),h||(z.addClass("cropper-moving"),z.addClass("cropper-moving-"+i),h=i)}function u(){s&&clearTimeout(s),h&&(z.removeClass("cropper-moving"),z.removeClass("cropper-moving-"+h),h=!1)}function g(i,t,o){return i<t?t:o<i?o:i}function f(i,t){T.crop.height=i,void 0!==t&&(T.crop.width=t,z.css({width:T.crop.width+"px"})),y.css({height:T.crop.height+"px",width:T.crop.width+"px"});var o=a.width/H.width,e=T.crop.height/H.height,r=Math.max(o,e);r!==T.minScale&&(T.minScale=r,Y.slider({min:M(r)}))}function v(i,t,o,e){var r=!1;void 0!==o&&(r=function(i){{if(T.scale!==i){T.scale=i;var t=d(),o={width:t.width+"px",height:t.height+"px"};return X.css(o),W.css(o),!0}return!1}}(o));var n=d();if(void 0!==i&&(i=g(i,T.crop.width-n.width,0),T.container.left!==i&&(T.container.left=i,r=!0)),void 0!==t&&(t=g(t,T.crop.height-n.height,0),T.container.top!==t&&(T.container.top=t,r=!0)),r){var a={left:T.container.left+"px",top:T.container.top+"px"};(void 0===e||e)&&W.css(a),X.css(a)}return r}function m(i,t,o,e){var r=d();if(null==t&&(t=(T.crop.width/2-T.container.left)/r.width),null==o&&(o=(T.crop.height/2-T.container.top)/r.height),(i=g(i,T.minScale,l()))!==T.scale){var n=d(i),a=Math.round((n.width-r.width)*t),c=Math.round((n.height-r.height)*o),s=T.container.left-a,h=T.container.top-c;v(s,h,i),!1!==e&&Y.slider("value",M(i))}}function w(i,t,o,e){!a.autoZoom&&e<i&&(i=e);var r=Math.round((i-t)/2)+o;0<r&&(r=0),f(Math.round(i));c();e<i?m(i/H.height):v(void 0,r)}function M(i){return Math.log(100*i)/Math.log(1.03)}function x(){z.addClass("cropper-has-changes")}function i(o){var i,t,e=(i=d(),(t={resizeWidth:i.width,resizeHeight:i.height,offsetX:Math.max(-T.container.left),offsetY:Math.max(-T.container.top),cropX:Math.max(0,Math.round(-T.container.left/T.scale)),cropY:Math.max(0,Math.round(-T.container.top/T.scale)),cropWidth:Math.round(T.crop.width/T.scale),cropHeight:Math.round(T.crop.height/T.scale),width:T.crop.width,height:T.crop.height,urlPrefix:a.urlPrefix,urlPostfix:a.urlPostfix,urlOriginal:a.urlOriginal,cropThenResize:void 0!==a.cropX}).cropX2=t.cropX+t.cropWidth,t.cropY2=t.cropY+t.cropHeight,a.urlAdapter.toSrc(t));z.addClass("cropper-loading"),S(e,function(i,t){k(r).attr("src",t),z.removeClass("cropper-loading"),o()}),z.removeClass("cropper-has-changes"),a.imgLoadingClass&&k(r).removeClass(a.imgLoadingClass)}function C(){e||(e=!0,i(t))}function t(i){b||(b=!0,L&&L.removeClass("cropper-cropping"),y.resizable("destroy"),W.draggable("destroy"),Y.slider("destroy"),z.remove(),a.imgLoadingClass&&k(r).removeClass(a.imgLoadingClass),k(r).css("display",P),i||void 0===n||n.destroy())}function S(i,t){var o=new Image;o.onload=function(){t(o,i)},o.src=i}var z=k('<div class="mo-cropper cropper-hidden" tabindex="-1"><div class="cropper-frame"><div class="clipping-container"><img draggable="false" class="clipped clipped-image original-src"></div><div class="clip-handle ui-resizable-s"></div></div><div class="outer-image-container"><img class="outer-image original-src"></div><div class="copper-zoom-slider"></div><div class="tool-crop"><i class="fa fa-check" aria-hidden="true"></i></div></div>');k(r).after(z),a.imgLoadingClass&&k(r).addClass(a.imgLoadingClass);var o=a.urlAdapter.fromSrc(r.src);o||(void 0!==a.urlAdapter.defaultPrefix?(a.urlOriginal=r.src,a.urlPrefix=a.urlAdapter.defaultPrefix,a.urlPostfix=r.src):console.error("FAILED PARSING",r.src));k.extend(a,o),a.width||(a.width=r.width,a.height=r.height);var H,X=z.find(".clipped"),y=z.find(".cropper-frame"),W=z.find(".outer-image-container"),Y=z.find(".copper-zoom-slider"),P=k(r).css("display"),b=!1,e=!1,L=!1;void 0!==a.containerSelector&&(L=k(a.containerSelector));var T={container:{},crop:{}},A=a.urlOriginal||(a.urlPrefix||"")+(a.urlPostfix||"");A.match(/[a-z]+:/)||(A="http://"+A);return S(A,function(i,t){var o,e;z.find(".original-src").attr("src",t),H={width:i.naturalWidth,height:i.naturalHeight},L&&L.addClass("cropper-cropping"),!1!==a.autoClose&&z.focusout(function(i){null!=i.relatedTarget&&z.get(0).contains(i.relatedTarget)||void 0!==i.delegatedTarget||b||C()}),z.find(".tool-crop").on("click",function(){C()}),z.focus(),function(){var i,t,o,e,r;if(void 0!==a.resizeWidth)e=a.resizeWidth/H.width,i=a.height,r=a.width,t=-a.offsetX,o=-a.offsetY;else if(void 0!==a.cropX2||void 0!==a.cropWidth)null==a.cropWidth&&(a.cropWidth=a.cropX2-a.cropX),null==a.cropHeight&&(a.cropHeight=a.cropY2-a.cropY),null==a.cropX&&(a.cropX=0),null==a.cropY&&(a.cropY=0),e=a.width/a.cropWidth,i=a.height||a.cropHeight*e,r=a.width,t=Math.round(-a.cropX*e),o=Math.round(-a.cropY*e);else{e=a.width/H.width,i=a.height||Math.round(H.height*e),r=a.width;var n=d(e);t=Math.round((r-n.width)/2),o=Math.round((i-n.height)/2)}f(i,r),v(t,o,e)}(),y.resizable({minHeight:40,handles:{s:".clip-handle"},start:function(i,t){z.focus(),p("handle"),o=T.container.top,e=d().height},stop:function(i,t){u(),x()},resize:function(i,t){w(t.size.height,t.originalSize.height,o,e),x(),t.size.height=T.crop.height,void 0!==n&&n._trigger("cropheight",null,{value:T.crop.height})}}),W.draggable({scroll:!1,start:function(i,t){z.focus(),p("drag")},stop:function(i,t){x(),u()},drag:function(i,t){v(Math.round(t.position.left),Math.round(t.position.top),void 0,!1),t.position.left=T.container.left,t.position.top=T.container.top,x()}}).on("wheel",function(i){if(a.shiftWheel&&!i.shiftKey)return!0;var t=-i.originalEvent.deltaY;if(z.focus(),0!==t){p("wheel"),s=setTimeout(u,500);var o=d(),e=i.originalEvent.offsetX/o.width,r=i.originalEvent.offsetY/o.height,n=0<t?1.1*T.scale:T.scale/1.1;m(n,e,r),x()}return!1}).on("click",function(i){var t;z.focus(),t="click",h?u():p(t)}),Y.slider({min:Math.floor(M(T.minScale)),step:1,value:Math.round(M(T.scale)),max:Math.ceil(M(l())),slide:function(i,t){var o,e=(o=t.value,Math.pow(1.03,o)/100);m(e,void 0,void 0,!1),x(),t.value=M(T.scale)},start:function(){p("slide")},stop:function(){u()}}),k(r).css("display","none"),z.css("display","inline"==P?"inline-block":P),z.removeClass("cropper-hidden"),z.focus(),void 0!==n&&n._trigger("copperready")}),{getScale:c,updateScale:m,getCropHeight:function(){return T.crop.Height},updateCropHeight:function(i){var t=T.crop.height;w(i,t,T.container.top,d().height)},dispose:t}}(this.element.get(0),this.options,this)},scale:function(i){if(void 0===i)return this.options.instance.getScale();this.options.instance.updateScale(i)},cropHeight:function(i){if(void 0===i)return this.options.instance.getCropHeight();this.options.instance.updateCropHeight(i)},_destroy:function(){this.options.instance.dispose(!0)}})}(jQuery);
//# sourceMappingURL=jqueryui-mosaico-cropper.min.js.map